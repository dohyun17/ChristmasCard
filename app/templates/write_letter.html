{% extends "base.html" %}

{% block content %}
<div class="christmas-container">
    <h1 class="christmas-title">âœ‰ï¸ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ í¸ì§€ ì“°ê¸° âœ‰ï¸</h1>
    
    <form method="POST" class="christmas-form" onsubmit="clearAutosaveData()">
        <div class="form-group">
            <label for="sender">ë³´ë‚´ëŠ” ì‚¬ëŒ:</label>
            <input type="text" id="sender" name="sender" placeholder="ë‹¹ì‹ ì˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" required oninput="updateSender()">
        </div>
        
        <div class="form-group">
            <label for="content">í¸ì§€ ë‚´ìš©:</label>
            <textarea id="content" name="content" rows="10" placeholder="ë”°ëœ»í•œ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë§ˆìŒì„ ë‹´ì•„ì£¼ì„¸ìš”" required oninput="updateCharacterCount()"></textarea>
            <p>ê¸€ì ìˆ˜: <span id="charCount">0</span></p> <!-- ê¸€ì ìˆ˜ í‘œì‹œ -->
        </div>

        <!-- ê°ì • í‘œí˜„ ë²„íŠ¼ -->
        <div class="emotion-container">
            <label>ê°ì • í‘œí˜„:</label>
            <button type="button" onclick="insertEmotion('ğŸ˜Š')">ğŸ˜Š</button>
            <button type="button" onclick="insertEmotion('â¤ï¸')">â¤ï¸</button>
            <button type="button" onclick="insertEmotion('ğŸ‰')">ğŸ‰</button>
            <button type="button" onclick="insertEmotion('ğŸ˜¢')">ğŸ˜¢</button>
            <button type="button" onclick="insertEmotion('ğŸ˜„')">ğŸ˜„</button>
            <button type="button" onclick="insertEmotion('âœ¨')">âœ¨</button>
            <button type="button" onclick="insertEmotion('ğŸ„')">ğŸ„</button>
            <button type="button" onclick="insertEmotion('ğŸŒŸ')">ğŸŒŸ</button>
        </div>

        <button type="submit" class="christmas-button">ğŸ„ í¸ì§€ ë³´ë‚´ê¸° ğŸ„</button>
    </form>

    <!-- ìë™ ì €ì¥ ì•ˆë‚´ ë©”ì‹œì§€ -->
    <div id="autosaveMessage" style="display:none; color: green; margin-top: 10px;">
        ìë™ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!
    </div>

    <!-- í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ ì¶”ê°€ -->
    <a href="{{ url_for('main.home') }}" class="christmas-button">ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

    <!-- í¸ì§€ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
    <a href="{{ url_for('main.letter_list') }}" class="christmas-button">ğŸ“œ í¸ì§€ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
</div>

<script>
// ìë™ ì €ì¥ í•¨ìˆ˜
function autoSave() {
    const sender = document.getElementById('sender').value; // ë³´ë‚´ëŠ” ì‚¬ëŒ ê°€ì ¸ì˜¤ê¸°
    const content = document.getElementById('content').value; // ì‚¬ìš©ì ì…ë ¥ ê°€ì ¸ì˜¤ê¸°
    localStorage.setItem('autosaveSender', sender); // ë³´ë‚´ëŠ” ì‚¬ëŒì„ Local Storageì— ì €ì¥
    localStorage.setItem('autosaveContent', content); // í¸ì§€ ë‚´ìš©ì„ Local Storageì— ì €ì¥

    // ìë™ ì €ì¥ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
    const autosaveMessage = document.getElementById('autosaveMessage');
    autosaveMessage.style.display = 'block';

    // 2ì´ˆ í›„ì— ë©”ì‹œì§€ ìˆ¨ê¹€
    setTimeout(() => {
        autosaveMessage.style.display = 'none';
    }, 2000);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ Local Storageì—ì„œ ë°ì´í„° ë³µì›
window.onload = function() {
    const savedSender = localStorage.getItem('autosaveSender');
    const savedContent = localStorage.getItem('autosaveContent');

    if (savedSender) {
        document.getElementById('sender').value = savedSender; // ë³´ë‚´ëŠ” ì‚¬ëŒ ë³µì›
    }
    
    if (savedContent) {
        document.getElementById('content').value = savedContent; // í¸ì§€ ë‚´ìš© ë³µì›
        document.getElementById('charCount').innerText = savedContent.length; // ê¸€ì ìˆ˜ ì—…ë°ì´íŠ¸
    }
};

// 10ì´ˆë§ˆë‹¤ autoSave í•¨ìˆ˜ ì‹¤í–‰
setInterval(autoSave, 10000); // ì—¬ê¸°ì„œ ì£¼ê¸°ë¥¼ 10000ms(10ì´ˆ)ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

// ê°ì • í‘œí˜„ í•¨ìˆ˜
function insertEmotion(emotion) {
    const contentTextarea = document.getElementById('content');
    contentTextarea.value += emotion; // ì„ íƒí•œ ì´ëª¨ì§€ë¥¼ í…ìŠ¤íŠ¸ ì˜ì—­ì— ì¶”ê°€
}

// ê¸€ì ìˆ˜ ì¹´ìš´í„° í•¨ìˆ˜
function updateCharacterCount() {
    const content = document.getElementById('content').value;
    document.getElementById('charCount').innerText = content.length; // ê¸€ì ìˆ˜ ì—…ë°ì´íŠ¸
}

// ë³´ë‚´ëŠ” ì‚¬ëŒ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateSender() {
    const sender = document.getElementById('sender').value;
    localStorage.setItem('autosaveSender', sender); // ë³´ë‚´ëŠ” ì‚¬ëŒì„ Local Storageì— ì €ì¥
}

// í¸ì§€ë¥¼ ë³´ë‚¸ í›„ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„° ì‚­ì œ í•¨ìˆ˜
function clearAutosaveData() {
    localStorage.removeItem('autosaveSender'); // ë³´ë‚´ëŠ” ì‚¬ëŒ ë°ì´í„° ì‚­ì œ
    localStorage.removeItem('autosaveContent'); // í¸ì§€ ë‚´ìš© ë°ì´í„° ì‚­ì œ
}
</script>

<style>
.emotion-container {
    margin-top: 10px;
}
.emotion-container button {
    margin-right: 5px;
}
#autosaveMessage {
    font-weight: bold;
}
</style>

{% endblock %}
