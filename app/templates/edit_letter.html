{% extends "base.html" %}

{% block content %}
<div class="christmas-container">
    <h1 class="christmas-title">ğŸ–Šï¸ í¸ì§€ ìˆ˜ì •í•˜ê¸° ğŸ–Šï¸</h1>
    
    <form method="POST" enctype="multipart/form-data" class="christmas-form" onsubmit="clearStorage()">
        <div class="form-group">
            <label for="sender">ë³´ë‚´ëŠ” ì‚¬ëŒ:</label>
            <input type="text" id="sender" name="sender" value="{{ letter.sender }}" required oninput="updateSender()">
        </div>
        
        <div class="form-group">
            <label for="content">í¸ì§€ ë‚´ìš©:</label>
            <textarea id="content" name="content" rows="10" required oninput="updateCharacterCount()">{{ letter.content }}</textarea>
            <p>ê¸€ì ìˆ˜: <span id="charCount">{{ letter.content|length }}</span></p> <!-- ê¸€ì ìˆ˜ í‘œì‹œ -->
        </div>
        
        {% if letter.file %}
        <div class="form-group">
            <p>í˜„ì¬ ì²¨ë¶€ íŒŒì¼: {{ letter.file }}</p>
            <label for="file">ìƒˆ íŒŒì¼ ì²¨ë¶€ (ì„ íƒì‚¬í•­):</label>
            <input type="file" id="file" name="file">
        </div>
        {% endif %}
        
        <!-- ê°ì • í‘œí˜„ ë²„íŠ¼ -->
        <div class="emotion-container">
            <label>ê°ì • í‘œí˜„:</label>
            <button type="button" onclick="insertEmotion('ğŸ˜Š')">ğŸ˜Š</button>
            <button type="button" onclick="insertEmotion('â¤ï¸')">â¤ï¸</button>
            <button type="button" onclick="insertEmotion('ğŸ‰')">ğŸ‰</button>
            <button type="button" onclick="insertEmotion('ğŸ˜¢')">ğŸ˜¢</button>
            <button type="button" onclick="insertEmotion('ğŸ˜„')">ğŸ˜„</button>
            <button type="button" onclick="insertEmotion('âœ¨')">âœ¨</button>
            <button type="button" onclick="insertEmotion('ğŸ„')">ğŸ„</button>
            <button type="button" onclick="insertEmotion('ğŸŒŸ')">ğŸŒŸ</button>
        </div>

        <button type="submit" class="christmas-button">ğŸ„ í¸ì§€ ìˆ˜ì •í•˜ê¸° ğŸ„</button>
    </form>
    
    <a href="{{ url_for('letter_detail', id=letter.id) }}" class="christmas-button">ğŸ”™ ëŒì•„ê°€ê¸°</a>
</div>

<script>
// ìë™ ì €ì¥ í•¨ìˆ˜
function autoSave() {
    const sender = document.getElementById('sender').value; // ë³´ë‚´ëŠ” ì‚¬ëŒ ê°€ì ¸ì˜¤ê¸°
    const content = document.getElementById('content').value; // ì‚¬ìš©ì ì…ë ¥ ê°€ì ¸ì˜¤ê¸°
    localStorage.setItem('autosaveSender', sender); // ë³´ë‚´ëŠ” ì‚¬ëŒì„ Local Storageì— ì €ì¥
    localStorage.setItem('autosaveContent', content); // í¸ì§€ ë‚´ìš©ì„ Local Storageì— ì €ì¥

    // ìë™ ì €ì¥ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
    const autosaveMessage = document.getElementById('autosaveMessage');
    autosaveMessage.style.display = 'block';

    // 2ì´ˆ í›„ì— ë©”ì‹œì§€ ìˆ¨ê¹€
    setTimeout(() => {
        autosaveMessage.style.display = 'none';
    }, 2000);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ Local Storageì—ì„œ ë°ì´í„° ë³µì›
window.onload = function() {
    const savedSender = localStorage.getItem('autosaveSender');
    const savedContent = localStorage.getItem('autosaveContent');

    if (savedSender) {
        document.getElementById('sender').value = savedSender; // ë³´ë‚´ëŠ” ì‚¬ëŒ ë³µì›
    }
    
    if (savedContent) {
        document.getElementById('content').value = savedContent; // í¸ì§€ ë‚´ìš© ë³µì›
        document.getElementById('charCount').innerText = savedContent.length; // ê¸€ì ìˆ˜ ì—…ë°ì´íŠ¸
    }
};

// 10ì´ˆë§ˆë‹¤ autoSave í•¨ìˆ˜ ì‹¤í–‰
setInterval(autoSave, 10000); // ì—¬ê¸°ì„œ ì£¼ê¸°ë¥¼ 10000ms(10ì´ˆ)ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

// ê°ì • í‘œí˜„ í•¨ìˆ˜
function insertEmotion(emotion) {
    const contentTextarea = document.getElementById('content');
    contentTextarea.value += emotion; // ì„ íƒí•œ ì´ëª¨ì§€ë¥¼ í…ìŠ¤íŠ¸ ì˜ì—­ì— ì¶”ê°€
    updateCharacterCount(); // ê¸€ì ìˆ˜ ì—…ë°ì´íŠ¸ í˜¸ì¶œ
}

// ê¸€ì ìˆ˜ ì¹´ìš´í„° í•¨ìˆ˜
function updateCharacterCount() {
    const content = document.getElementById('content').value;
    document.getElementById('charCount').innerText = content.length; // ê¸€ì ìˆ˜ ì—…ë°ì´íŠ¸
}

// ë³´ë‚´ëŠ” ì‚¬ëŒ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateSender() {
    const sender = document.getElementById('sender').value;
    localStorage.setItem('autosaveSender', sender); // ë³´ë‚´ëŠ” ì‚¬ëŒì„ Local Storageì— ì €ì¥
}

// í¼ ì œì¶œ ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í´ë¦¬ì–´ í•¨ìˆ˜
function clearStorage() {
    localStorage.removeItem('autosaveSender'); // ë³´ë‚´ëŠ” ì‚¬ëŒ ì‚­ì œ
    localStorage.removeItem('autosaveContent'); // í¸ì§€ ë‚´ìš© ì‚­ì œ
}

// ëˆˆ ë‚´ë¦¬ëŠ” íš¨ê³¼ (write_letter.htmlê³¼ ë™ì¼)
function createSnowflake() {
    const snowflake = document.createElement('div');
    snowflake.classList.add('snowflake');
    snowflake.innerHTML = 'â„ï¸';
    const leftPosition = Math.random() * window.innerWidth + 'px';
    snowflake.style.left = leftPosition;
    snowflake.style.animationDuration = Math.random() * 3 + 2 + 's'; // 2-5ì´ˆ
    snowflake.style.opacity = Math.random();
    snowflake.style.fontSize = Math.random() * 10 + 10 + 'px'; // 10-20px
    document.body.appendChild(snowflake);
    
    // ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚˜ë©´ ìš”ì†Œ ì œê±°
    snowflake.addEventListener('animationend', () => {
        snowflake.remove();
    });
}

setInterval(createSnowflake, 100);
</script>

<style>
.christmas-container {
    padding: 20px;
}

.christmas-title {
    font-size: 24px;
}

.form-group {
    margin-bottom: 15px;
}

.emotion-container {
    margin-top: 10px;
}

.emotion-container button {
    margin-right: 5px;
}

/* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.christmas-button {
    display: inline-block;
    padding: 12px 24px; /* ë²„íŠ¼ì˜ íŒ¨ë”© ì„¤ì • */
    margin-top: 10px; /* ë²„íŠ¼ ê°„ê²© ì„¤ì • */
}

/* ê¸°ë³¸ ë²„íŠ¼ ìƒ‰ìƒ */
.christmas-button {
    background-color: #f44336; /* ë¹¨ê°„ìƒ‰ ë°°ê²½ */
    color: white; /* í°ìƒ‰ ê¸€ì */
}

.christmas-button:hover {
    background-color: #d32f2f; /* í˜¸ë²„ ì‹œ ì–´ë‘ìš´ ë¹¨ê°„ìƒ‰ */
}
</style>

{% endblock %}
